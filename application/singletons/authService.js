System.register(["aurelia-framework","aurelia-fetch-client","../config/config"],function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n,i,s,o,r,u,a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();return{setters:[function(t){n=t.Aurelia,i=t.inject,s=t.bindable},function(t){o=t.HttpClient},function(t){r=t["default"]}],execute:function(){u=function(){function t(t,n,i){e(this,s),this.response=null,this.session=null,this.isAuthenticated=!1,this.initSession=this.startSession(),this.http=i,this.app=n,this.config=t}a(t,[{key:"login",value:function(t){var e=this;this.http.fetch(this.config.authUrl,{credentials:"include",method:"post",body:JSON.stringify(t)}).then(function(t){return t.json()}).then(function(t){e.response=t,"success"==t.status&&(sessionStorage[r.tokenPrefix+"AuthToken"]=t.data,e.response=t,e.startSession(),e.isAuthenticated&&e.app.setRoot("app"))})}},{key:"logout",value:function(){this.destroySession()}},{key:"startSession",value:function(){return this.jwt=sessionStorage.getItem(r.tokenPrefix+"AuthToken"),null===this.jwt?void(this.session=null):(this.user=JSON.parse(atob(this.jwt.split(".")[1])),void(this.isAuthenticated=!0))}},{key:"destroySession",value:function(){sessionStorage.removeItem(r.tokenPrefix+"AuthToken"),this.session=null,this.app.setRoot("login")}},{key:"can",value:function(t){return!0}}]);var s=t;return t=i(r,n,o)(t)||t}(),t("default",u)}}});