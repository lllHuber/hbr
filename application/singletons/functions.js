System.register(["config/config","aurelia-framework","aurelia-router","singletons/multiObserver"],function(s){"use strict";function e(s,e){if(!(s instanceof e))throw new TypeError("Cannot call a class as a function")}var t,r,a,o,i,l=function(){function s(s,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(s,r.key,r)}}return function(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),e}}();return{setters:[function(s){t=s["default"]},function(s){r=s.inject},function(s){a=s.Router},function(s){o=s.MultiObserver}],execute:function(){i=function(){function s(s,t,r){e(this,i),this.config=s,this.router=t,this.observer=r,this.$ui={resizable:""},this.direction="desc",this.distance=null,this.filter={},this.filterChange=0,this.toolbar={addProgram:!1,filter:!1,edit:!1,content:{filterPrograms:!0,filterSeasons:!1,filterSeries:!1}},this.$T={program:{},season:{},series:{}},this.resetObjects(),this.$D={allCategories:this.allCategories,allSeries:this.allSeries,allSeasons:this.allSeasons,allPrograms:this.allPrograms,allSources:this.allSources,allLocations:this.allLocations,programStatus:this.programStatus,broadcastStatus:this.broadcastStatus,programStatusNames:{},broadcastStatusNames:{},locationNames:{},sourceNames:{},seriesNames:{}}}l(s,[{key:"showToolbar",value:function(s,e){this.hideAllToolbars(),this.triggerFilter(),this.toolbar[s]=!0,$("#"+s).removeClass("hide"),$(e).focus()}},{key:"hideToolbar",value:function(s){$("#"+s).addClass("hide")}},{key:"toggleToolbar",value:function(s,e){$(".lstvToolbar .content:not(#"+s+")").addClass("hide"),$("#"+s).hasClass("hide")?(this.hideAllToolbars(),this.toolbar[s]=!0,$("#"+s).removeClass("hide"),$(e).focus()):(this.hideAllToolbars(),this.toolbar[s]=!1,$("#"+s).addClass("hide"))}},{key:"hideAllToolbars",value:function(){var s=this;$(".lstvToolbar .content").addClass("hide"),$.each(this.toolbar,function(e){"content"!=e&&(s.toolbar[e]=!1)})}},{key:"setToolbarContent",value:function(s){var e=this;$.each(this.toolbar.content,function(s){e.toolbar.content[s]=!1}),this.toolbar.content["filter"+s]=!0}},{key:"changeOrder",value:function(s,e){this.selectedClass="",this.order=e,"asc"==this.direction?(this.direction="desc",this.selectedClass="arrowDownDark"):(this.direction="asc",this.selectedClass="arrowUpDark"),$(".navOrder span").removeClass("arrowUpDark").removeClass("arrowDownDark").addClass("arrowUpLight"),$("."+s+" span").removeClass("arrowUpLight").addClass(this.selectedClass)}},{key:"resetOrder",value:function(){this.order=!1,$(".navOrder span").removeClass("arrowUpDark").removeClass("arrowDownDark").addClass("arrowUpLight")}},{key:"updateFilter",value:function(s,e){var t=this,r="",a=s;$.isArray(s)?(r="#"+s[0].split(".")[1],this.filter["___"+s[0].split(".")[1]]={},$.each(s,function(r,a){""===e||e==-1?delete t.filter["___"+s[0].split(".")[1]]:t.filter["___"+s[0].split(".")[1]][a.split(".")[1]]=e,t.triggerFilter()})):(r="#"+s.split(".")[1],""===e||e==-1?delete this.filter[s.split(".")[1]]:this.filter[s.split(".")[1]]=e,this.triggerFilter()),0!==Object.keys(this.filter).length?this.filterApplied=!0:this.filterApplied=!1,this.updateForm(a,e),this.removeErrorClass(r)}},{key:"triggerFilter",value:function(){this.filterChange++}},{key:"resetFilter",value:function(s){var e=this;$.each(this.filter,function(s){s.indexOf("___")<=1&&delete e.filter[s]}),this.filterApplied=!1,this.triggerFilter(),$("#filter form").each(function(s,e){e.reset()}),this.resetOrder(),this.resetObjects(),$(s).focus(),this.scrollTop(),this.removeStatusClasses()}},{key:"updateForm",value:function(s,e){s=$.isArray(s)?s[0].split(".")[0]+"\\."+s[0].split(".")[1]:s.split(".")[0]+"\\."+s.split(".")[1],$("#"+s).val(e.toString())}},{key:"resetObjects",value:function(){var s=this;$.each(this.$T,function(e){"program"===e?s.$T[e]={crud:!0,program_comments:"",program_aquired:"0",program_need_editing:"0",program_ondemand:"0",program_status:"03",broadcast_status:"00",program_languages:[],requirements:[]}:"season"===e?s.$T[e]={crud:!0,season_comments:"",season_aquired:"0",season_is_ongoing:"0",season_ondemand:"0",season_status:"03",broadcast_status:"00",categoryIDs:[]}:"series"===e?s.$T[e]={crud:!0,series_comments:"",series_aquired:"0",series_ondemand:"0",series_status:"03",broadcast_status:"00",categoryIDs:[]}:s.$T[e]={crud:!0}}),this.addProgramRequirementsObserver(),this.addSeasonSeriesChangeObserver()}},{key:"edit",value:function(s,e){this.$T[s]=e,this.$T[s].crud=!0,"program"===s?(this.updateFilter("program.seriesID",e.seriesID),this.router.navigate("programs"),this.checkProgramRequirements(e)):"season"===s?(this.router.navigate("seasons"),this.updateFilter("season.seriesID",e.seriesID),this.triggerFilter()):"series"===s&&this.router.navigate("series"),this.addProgramRequirementsObserver()}},{key:"add",value:function(s,e){this.resetObjects(),this.$T[s].crud=!0,this.router.navigate(e)}},{key:"create",value:function(s,e){var t=this,r=[];"program"===s&&(r=this.$D.allPrograms),"season"===s&&(r=this.$D.allSeasons),"series"===s&&(r=this.$D.allSeries),this.validateForm("#crud")&&(this.url=this.config.serviceUrl+("?ws=create_"+s+"&item="+JSON.stringify(e)),$("#lstvLoader").show(),$.get(this.url,function(s){$("#lstvLoader").hide(),"success"===s.status&&(r.unshift(s.data),t.resetObjects(),t.removeStatusClasses()),t.showNotification(s.status,s.msg)},"json"))}},{key:"trash",value:function(s,e){var t=this,r=[];"program"===s&&(r=this.$D.allPrograms),"season"===s&&(r=this.$D.allSeasons),"series"===s&&(r=this.$D.allSeries),this.url=this.config.serviceUrl+("?ws=trash_"+s+"&id="+e),this.closeAllModals(),$("#lstvLoader").show(),$.get(this.url,function(e){$("#lstvLoader").hide(),"success"===e.status&&($.each(r,function(a,o){o&&o[s+"ID"]==e.id&&(r.splice(a,1),t.scrollTop())}),t.resetObjects(),t.removeStatusClasses()),t.showNotification(e.status,e.msg)},"json")}},{key:"update",value:function(s,e){var t=this,r=[];"program"===s&&(r=this.$D.allPrograms),"season"===s&&(r=this.$D.allSeasons),"series"===s&&(r=this.$D.allSeries),this.validateForm("#crud")&&(this.url=this.config.serviceUrl+("?ws=update_"+s+"&item="+JSON.stringify(e)),console.log(this.url),$("#lstvLoader").show(),$.get(this.url,function(s){$("#lstvLoader").hide(),"success"===s.status&&t.scrollTop(),t.showNotification(s.status,s.msg)},"json"))}},{key:"addProgramRequirementsObserver",value:function(){this.observer.observe(this.$T.program,["program_aquired","program_need_editing","program_status","broadcast_status"],this.checkProgramRequirements.bind(this))}},{key:"addSeasonSeriesChangeObserver",value:function(){this.observer.observe(this.$T.season,["seriesID"],this.generateSeasonFormData.bind(this))}},{key:"getStatusName",value:function(s){$.each(this.$D.programStatus,function(e,t){if(t.program_status==s.toString())return""+t.program_status_name})}},{key:"showNotification",value:function(s,e){"error"===s?$("notification .content").html("<span class='iconic' data-glyph='x' aria-hidden='true'></span>&nbsp;&nbsp;"+e):$("notification .content").html("<span class='iconic' data-glyph='check' aria-hidden='true'></span>&nbsp;&nbsp;"+e),$(".lstvNotification").removeClass("hide"),$(".lstvNotification .content").removeClass("error").removeClass("success").addClass(s),this.hideNotification()}},{key:"hideNotification",value:function(){var s=arguments.length<=0||void 0===arguments[0]?5e3:arguments[0];clearTimeout(this.clearNotification),this.clearNotification=setTimeout(function(){$(".lstvNotification").addClass("hide")},s)}},{key:"scrollTop",value:function(){$(".grid-block").scrollTop(0)}},{key:"characterLimit",value:function(s,e){var t=$(s).val().length;return t>=e?($(s).addClass("error"),$(s).closest(".row").find("small").addClass("error"),$(s).closest(".row").find("label").addClass("error"),!1):($(s).removeClass("error"),$(s).closest(".row").find("small").removeClass("error"),$(s).closest(".row").find("label").removeClass("error"),!0)}},{key:"validateForm",value:function(s){var e={},t=!0;return $.each($(s+" [required]"),function(s,r){if($(r).find("input").length>0){var a=0;$(r).find("input").each(function(s,e){e.checked&&(a=1)}),0===a&&($(r).closest(".row").find("label").addClass("error"),t=!1)}else""===r.value&&(e[r.id]=r.value,$(r).addClass("error"),$(r).closest(".row").find("label").addClass("error"),t=!1)}),this.characterLimit("#desc_short",100)&&this.characterLimit("#desc_long",235)||(t=!1),$.each(e,function(s){return $("#"+s).focus(),!1}),t||this.showNotification("error","Validation errors occured!"),this.scrollTop(),t}},{key:"removeErrorClass",value:function(s){$(s).find("input").length>0?$(s).find("label").removeClass("error"):($(s).removeClass("error"),$(s).closest(".row").find("label").removeClass("error"))}},{key:"removeStatusClasses",value:function(){$("form input").removeClass("error").removeClass("success"),$("form label").removeClass("error").removeClass("success"),$("form textarea").removeClass("error").removeClass("success"),$("form select").removeClass("error").removeClass("success")}},{key:"generateProgramFormData",value:function(){var s=this,e=0,t="",r="",a="";$.each(this.$D.allPrograms,function(t,r){1!=r.trashed&&r.seasonID==s.$T.program.seasonID&&parseInt(r.episode_no)>e&&(e=r.episode_no)}),e++,this.$T.program.episode_no=e,e>0&&e<10&&(e="0"+e),$.each(this.$D.allSeasons,function(e,t){if(1!=t.trashed&&t.seasonID==s.$T.program.seasonID)return r=t.season_code,!1}),$.each(this.$D.allSeries,function(e,r){if(1!=r.trashed&&r.seriesID==s.$T.program.seriesID)return t=r.series_code,!1});var o=r.replace(t,""),i=0,l="";o&&(i=4-o.length);for(var n=0;n<i;n++)l+="0";a=""+t+l+o+e,this.$T.program.program_code=a,this.$T.program.program_code_schedule=a,this.$T.program.video_url_sd="xrtmp://stream1.lifestyletv.se/vod/$mp4:INT/"+t+"/"+r+"/"+a+"_mq.mp4",this.$T.program.video_url_hd="xrtmp://stream1.lifestyletv.se/vod/$mp4:INT/"+t+"/"+r+"/"+a+"_hq.mp4",$("#episode_no").addClass("success"),$("#program_code").addClass("success"),$("#program_code_schedule").addClass("success"),$("#video_url_sd").addClass("success"),$("#video_url_hd").addClass("success"),this.removeErrorClass("#seasonID"),this.removeErrorClass("#episode_no"),this.removeErrorClass("#program_code"),this.removeErrorClass("#program_code_schedule"),this.removeErrorClass("#video_url_hd"),this.removeErrorClass("#video_url_sd")}},{key:"generateSeasonFormData",value:function(){var s=this,e=new Date,t=e.getFullYear(),r=t.toString().slice(2),a="",o="",i=0;$.each(this.$D.allSeries,function(e,t){if(t.seriesID==s.$T.season.seriesID)return a=t.series_code,o=t.seriesID,!1}),""!==a&&($.each(this.$D.allSeasons,function(s,e){1!=e.trashed&&e.seriesID==o&&e.season_code&&e.season_code.indexOf(r)>=0&&(i++,console.log(e.season_code))}),i++,i>0&&i<10&&(i="0"+i),this.$T.season.season_code=a+r+i,$("#season_code").removeClass("error").addClass("success"))}},{key:"checkProgramRequirements",value:function(){this.$T.program.requirements=[],"00"!==this.$T.program.program_status&&"03"!==this.$T.program.program_status&&"02"!==this.$T.program.broadcast_status&&"03"!==this.$T.program.broadcast_status&&"0"===this.$T.program.program_need_editing&&"1"===this.$T.program.program_aquired?this.$T.program.requirements.push({text:"Ready to be aired",status:"success"}):this.$T.program.requirements.push({text:"Ready to be aired",status:"error"}),this.setNextScheduledAirDate(this.$T.program.programID),this.setOnDemandVideoStatus(this.$T.program.programID),this.$T.program.requirements.push({text:"On-Demand graphic",status:"error"})}},{key:"setNextScheduledAirDate",value:function(s){var e=this;this.url=this.config.serviceUrl+("?ws=get_next_air_date&id="+s),$.get(this.url,function(s){"success"===s.status?e.$T.program.requirements.push({text:"Next scheduled air date: "+s.next_air_date,status:"success"}):e.$T.program.requirements.push({text:"Next scheduled air date",status:"error"})},"json")}},{key:"setOnDemandVideoStatus",value:function(s){var e=this;this.url=this.config.serviceUrl+("?ws=on_demand_video_files_exist&id="+s),$.get(this.url,function(s){"success"===s.status?e.$T.program.requirements.push({text:"On-Demand video",status:"success"}):e.$T.program.requirements.push({text:"On-Demand video",status:"error"})},"json")}},{key:"closePanel",value:function(s){this.resetObjects(),this.$T[s].crud=!1}},{key:"closeModal",value:function(s){$(s).fadeOut(250)}},{key:"closeAllModals",value:function(){$(".lstvModal").addClass("hide")}},{key:"openModal",value:function(s){var e=!(arguments.length<=1||void 0===arguments[1])&&arguments[1],t=!(arguments.length<=2||void 0===arguments[2])&&arguments[2];e&&t&&(this.$T[e]=t,this.$T[e].crud=!0),$(s).removeClass("hide").fadeIn(250)}},{key:"allPrograms",get:function(){var s=this;this.url=this.config.serviceUrl+"?ws=get_all_programs",$("#lstvLoader").show(),$.get(this.url,function(e){$("#lstvLoader").hide(),e.success===!0&&(s.$D.allPrograms=e.data)},"json")}},{key:"allSeasons",get:function(){var s=this;this.url=this.config.serviceUrl+"?ws=get_all_seasons",$("#lstvLoader").show(),$.get(this.url,function(e){$("#lstvLoader").hide(),e.success===!0&&(s.$D.allSeasons=e.data)},"json")}},{key:"allSeries",get:function(){var s=this;this.url=this.config.serviceUrl+"?ws=get_all_series",$("#lstvLoader").show(),$.get(this.url,function(e){$("#lstvLoader").hide(),e.success===!0&&(s.$D.allSeries=e.data,$.each(s.$D.allSeries,function(e,t){s.$D.seriesNames[t.seriesID]=t.series_name}))},"json")}},{key:"allCategories",get:function(){var s=this;this.url=this.config.serviceUrl+"?ws=get_all_categories",$("#lstvLoader").show(),$.get(this.url,function(e){$("#lstvLoader").hide(),e.success===!0&&(s.$D.allCategories=e.data)},"json")}},{key:"allSources",get:function(){var s=this;this.url=this.config.serviceUrl+"?ws=get_all_sources",$("#lstvLoader").show(),$.get(this.url,function(e){$("#lstvLoader").hide(),e.success===!0&&(s.$D.allSources=e.data,$.each(s.$D.allSources,function(e,t){s.$D.sourceNames[t.sourceID]=t.source_name}))},"json")}},{key:"allLocations",get:function(){var s=this;this.url=this.config.serviceUrl+"?ws=get_all_locations",$("#lstvLoader").show(),$.get(this.url,function(e){$("#lstvLoader").hide(),e.success===!0&&(s.$D.allLocations=e.data,$.each(s.$D.allLocations,function(e,t){s.$D.locationNames[t.program_locationID]=t.location_name+" "+(t.location_description?"("+t.location_description+")":"")}))},"json")}},{key:"programStatus",get:function(){var s=this;this.url=this.config.serviceUrl+"?ws=get_program_status",$("#lstvLoader").show(),$.get(this.url,function(e){$("#lstvLoader").hide(),e.success===!0&&(s.$D.programStatus=e.data,s.$D.programStatusNames={},$.each(s.$D.programStatus,function(e,t){s.$D.programStatusNames[t.program_status]=t.program_status_name}))},"json")}},{key:"broadcastStatus",get:function(){var s=this;this.url=this.config.serviceUrl+"?ws=get_broadcast_status",$("#lstvLoader").show(),$.get(this.url,function(e){$("#lstvLoader").hide(),e.success===!0&&(s.$D.broadcastStatus=e.data,s.$D.broadcastStatusNames={},$.each(s.$D.broadcastStatus,function(e,t){s.$D.broadcastStatusNames[t.broadcast_status]=t.broadcast_status_name}))},"json")}}]);var i=s;return s=r(t,a,o)(s)||s}(),s("default",i)}}});